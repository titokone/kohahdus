\section{Johdanto}

TitoTrainer on järjestelmä automaattisesti tarkastettavien TTK-91-konekielen harjoitustehtävien 
luomiseen ja ratkaisemiseen. Järjestelmä on tarkoitettu käytettäväksi opetuksen tukena, 
opetettaessa Tietokoneen toiminta -kurssia. Tietojenkäsittelytieteen opettajat voivat tehdä 
järjestelmään uusia tehtäviä ja määritellä kuinka ne tarkastetaan automaattisesti. 
Tietokoneen toiminta -kurssin opiskelijat ja kurssin tehtävistä kiinnostuneet itseopiskelijat 
voivat ratkaista tehtäviä ja saada palautetta niiden onnistumisesta.

Painopiste projektissa on opettajan ja opiskelijan käyttöliittymillä. Käyttöliittymistä tehdään 
mahdollisimman selkeät ja helppokäyttöiset. Opettajan käyttöliittymän avulla määritellään tehtävät 
parametreineen ja kuinka opiskelijan ratkaisun oikeellisuus tarkistetaan, sekä nähdään statistiikkatietoja 
opiskelijoiden suorituksista. Opiskelijan käyttöliittymän avulla opiskelija valitsee tehtäviä, 
syöttää niiden ratkaisut ja saa palautetta vastauksensa oikeellisuudesta.

Projekti käyttää valmiina olevaa Titokone-simulaattoria harjoitustehtävien ratkaisemiseen. Projektin 
rakennetaan olemassa olevaan eAssari-kehykseen, joka sopii geneeriseen automaattisesti tarkistettavien
tehtävien määrittelyyn ja toteutukseen. eAssarin keskeneräisyydestä johtuen kehystä tullaan muokkaamaan
tuotteella asetettujen vaatimusten täyttämiseksi.

Järjestelmä toteutetaan Java-kielellä ja järjestelmän käyttö vaatii, että selain tukee 
JavaScript-kieltä ja CSS-tyylitiedostoja. Järjestelmä toimii uusimmilla Firefox ja Internet 
Explorer-selaimilla.




\newpage
\section{Sanasto}
\input{termit}




\newpage
\section{Toiminnot}

Tämä luku kuvaa järjestelmän HTML-sivut ja sen, mitä toimintoja ne tarjoavät käyttäjälle.
			
\subsection{Rekisteröityminen}
Rekisteröintisivulla opiskelija rekisteröityy järjestelmän käyttäjäksi. Rekisteröinti vaatii seuraavat 
tiedot: etunimi, sukunimi, käyttökieli, sähköposti, opiskelijanumero tai henkilötunnus, sekä
haluttu käyttäjätunnus ja salasana

Täyttää vaatimukset: 4


\subsection{Käyttäjätietojen muokkaaminen}
Käyttäjätietosivulla sisäänkirjautunut käyttäjä voi muokata rekisteröintitietojaan, poislukien 
tunnus joka on valittu rekisteröidyttäessä. Käyttäjätietojen muokkaamisen ei tarvitse toimia
opettajien tunnusten kanssa, mutta odotettavissa on, että opettajatunnusten tukeminen ei aiheuta
minkäänlaista lisätyötä.

Täyttää vaatimukset: 6,8


\subsection{Kirjautuminen}
Kirjautumissivulla käyttäjä syöttää tunnuksensa, salasanansa ja pudotusvalikosta kurssin nimen.
Kurssivalinta määrittää, että minkä kurssin suorituksiin opiskelijan tekemät vastaukset tallennetaan.
Opettajan ollessa kyseessä kurssivalinnalla ei ole merkitystä. Jos kirjautuminen onnistuu, näytetään
tehtävälistaus. Jos kirjautuminen epäonnistuu, käyttäjä palautetaan kirjautumissivulle.

Täyttää vaatimukset: 5,2


\subsection{Kurssien ja tehtävien valinta (opettaja)}
Kirjautumisen jälkeen opettajalle näytetään kurssilistaus josta opettaja voi siirtyä
kurssin statistiikka-sivulle. Kurssilistauksen alla on myös lomake uuden kurssin
luomista varten.

Samalla sivulla näytetään myös tehtävälista. Listassa näytetään tehtävän kieli, aihepiiri
ja nimi, sekä viimeinen muokkauspäivä ja muokkaaja. Listattuja tehtäviä voi muokata ja
poistaa, sekä käynnistää uuden tehtävän luomisen.

Täyttää vaatimukset: 18,21


\subsection{Tehtävän määrittely (opettaja)}
Tehtävänmäärittelysivulla opettaja voi luoda uuden tehtävän tai muokata olemassa olevaa
tehtävää. Tehtävälle määritellään nimi, tehtävänanto, tarkastustyyppi (malliratkaisu/kiinteät arvot),
tehtävätyyppi (täyttötehtävä/ohjelmointitehtävä), sekä tarkastuskriteerit ja kriteerien palautteet.

Täyttää vaatimukset: 9,10,12,13,14,15,16,17,20,30-43,45-51,53,54


\subsection{Kurssin statistiikka (opettaja)}
Kurssin statistiikkasivulla opettajalle näytetään lista kaikkien kurssin tehtäviä suorittaneiden
opiskelijoiden suorituksista. Listassa näytetään opiskelijan nimi, opiskelijanumero tai henkilötunnus,
sekä onnistuneesti ratkaistujen tehtävien määrä. Lista on helposti tulostettavassa muodossa.

Listassa opiskelijan nimi toimii linkkinä ko. opiskelijan käyttäjätietosivulle.

Täyttää vaatimukset: 23


\subsection{Käyttäjän tiedot (opettaja)}
Käyttäjän statistiikkasivulla opettajalle näytetään opiskelijan tarkemmat tiedot.
Henkilötiedoista näytetään salasanaa lukuunottamatta kaikki rekisteröintitiedot.
Sivu sisältää myös napin, jota käyttämällä opettaja voi poistaa käyttäjän järjestelmästä.

Täyttää vaatimukset: 22


\subsection{Käyttäjien haku (opettaja)}
Hakusivulla opettaja voi etsiä nimen perustella käyttäjiä, ja siirtyä käyttäjätietosivulle
tarkastelemaan käyttäjän tarkempia tietoja.

\subsection{Tehtävien valinta (opiskelija)}
Kirjautumisen jälkeen opiskelijalle näytetään tehtävälista, josta opiskelija voi valita
tehtävän ratkaistavaksi. Listassa näytetään tehtävän kieli, aihepiiri ja nimi, sekä tieto
onko opiskelija yrittänyt jo tehtävän suoritusta ja onko yritys onnistunut.
Täyttää vaatimukset: 19(=25),29


\subsection{Tehtävään vastaaminen (opiskelija)}
Opiskelijan ratkaistavaksi valitsemasta tehtävästä näytetään nimi ja tehtävänanto,
mahdollinen valmis koodi mikäli kyseessä on täyttötehtävä, sekä tekstialue johon
opiskelija kirjoittaa vastauksensa. Lisäksi on linkki jolla pääsee takaisin tehtävälistaukseen.

Kun opiskelija on kirjoittanut vastauksensa, hän painaa "Suorita" -nappia joka vie
takaisin tehtävävastaussivulle. Sivulla näytetään samat tiedot kuin alussa, mutta
lisäksi näytetään palautetta ratkaisun onnistumisesta/epäonnistumisesta.

Täyttää vaatimukset: 9,10,26,27,28,52


\subsection{Tehtävien aihepiiri (opettaja)}
Tehtäville voidaan määritellä aihepiiri (category). Tämä yksittäiseen taskiin liittyvä tieto 
tallennetaan task tauluun taskmetadata-kenttään xml-muodossa muiden attribuuttien mukana. 
Aihepiirilista tallennetaan attributevalues-tauluun objecttype arvolla "Q".
Tehtävän luomisessa aihepiiri valitaan aihepiirilistasta, joka on HTML-sivulla esitettynä
pudotusvalikkona. Pudotusvalikon viimeinen valinta on uuden aihepiirin luonti, jonka valitsemalla
kutsutaan AJAX-tyyppisesti uutta JSP-sivua, joka luo uuden aihepiirin kantaan (käyttäen DBHandleria).
Tämä uusi aihepiiri lisätään myös aukiolevan tehtävänluontisivun aihepiirilistapudotusvalikkoon.

Aihepiirien hallinta on toteutettu erillisellä JSP-sivulla, jossa on lista aihepiireistä. 
Näitä aihepiirejä voi poistaa, muokata ja lisätä painamalla vastaavia HTML-linkkejä.

Täyttää vaatimukset: 53, 54, 55, 56


\subsection{Monikielisyys}
Opiskelijan käyttöliittymä toteutetaan suomen- ja englanninkielisenä. Opiskelija
valitsee rekisteröitymisen yhteydessä järjestelmän oletuskielen. Kirjautuessaan 
järjestelmään opiskelija voi halutessaan vaihtaa kielen toiseksi.

Opettajan käyttöliittymä toteutetaan ainoastaan englanniksi.  

Täyttää vaatimukset: 57,58








\newpage
\section{Arkkitehtuurisuunnitelma}

Järjestelmä on jaettu kahteen osajärjestelmään, Titokone ja eAssari/TitoTrainer. Ideaalitapaus
olisi ollut kolme osajärjestelmää, jossa eAssari on TitoTraineria kutsuva sovelluskehys. Tämä
malli ei kuitenkaan ole mahdollinen, johtuen eAssarin keskeneräisyydestä. Lopputuotteelle 
asettujen vaatimusten täyttäminen vaatii huomattavia lisäyksiä eAssariin, mm. puuttuvat
kurssien ja käyttäjien hallinta täytyy toteuttaa. Kireän aikataulun vuoksi eAssaria ei yritetä
säilyttää geneerisenä kehyksenä, vaan muokkauset tehdään vain Kohahdus projektin tarpeita
ajatellen. Käytännössä eAssarista tehdään siis ns. code fork, eli synnytetään täysin
TitoTrainer-spesifinen eAssari-versio, jonka ei taata olevan yhteensopiva geneerisen eAssarin kanssa.

Ainoa osuus eAssarista jota pyritään käyttämään sen alkuperäisen arkkitehtuurin mukaan,
on tietokanta. Tietokannan rakennetta ei muuteta, mutta kaikkia tauluja ei käytetä
(kts. tämän dokumentin luku Tietokanta).

TitoKonetta käytetään erikseen luotavan TitoState luokan kautta, jotta yhteys TitoKoneeseen
saadaan mahdollimman kevyeksi. TitoState käyttää suoraan TitoKoneen konkreettisia luokkia,
joita myös tarpeen tullen muokataan kaikkien suoritustietojen saamiseksi. Koska muokkauksien
tarvetta ja laajuutta on vaikea arvioida etukäteen, niiden yksityiskohdat jätetään täysin
TitoState luokan implementoijan vastuulle.

\begin{figure}[ht]
%	\includegraphics[width=15cm] {muut_kaaviot/yleiskuva1.eps}
%	\caption{yleiskuva1}
	\includegraphics[width=15cm] {muut_kaaviot/arkkitehtuuri.eps}
	\caption{Arkkitehtuuri}
\end{figure}





\newpage
\section{Tietokanta}

\begin{figure}[ht]
	\includegraphics[width=14cm] {database_diagram.eps}
	\caption{Tietokantakaavio}
\end{figure}

Tietokannan rakenteen määrää eAssari kehys. Rakenne on kuvattu kuvassa 1. Ajanpuutteesta johtuen
module-tietokantataulua ei tulla käyttämään sen mahdollistamassa laajuudessa. Sen sijaan että
kursseille luotaisiin useita moduuleja, luodaan jokaiselle kurssille vain yksi moduuli ja lisätään
kaikki tehtävät sinne. Näin vältetään tarve erilliselle moduulienhallinta toiminnolle ja käyttöliittymälle.

Tietokantaa käytetään aina DBHandler-nimisen singleton-luokan kautta, joka piilottaa tietokantarakenteen
yksityiskohdat. SQL-lauseita tulee siis vain DBHandler luokkaan eikä muualle koodiin. DBHandler-luokasta
voidaan luoda instanssi staattisen DBHandler.getInstance() -metodin avulla. Tämä tarkoittaa, että ko.
luokkaa voidaan käyttää virtuaalikoneen sisällä mistä vaan.

\subsection{Tasktype}
Tasktype on eAssari-kehyksen tarvitsema taulu, joka määrittelee tehtävätyypin käyttämät
Analyzer ja Displayer luokat. Tauluun olisi mahdollista tallentaa myös muuta
tehtävätyyppikohtaista tietoa, mutta ainakaan ensimmäisen iteraation kohdalla tälle ei ole
näkyvissä tarvetta.

\subsection{Task}
Task määrittelee tehtävän. Task-tauluun tallennetaan kriteerietä lukuunottamatta tehtävän kaikki tiedot.
Tunniste, nimi ja muokkaustiedoille on olemassa valmiit sarakkeet, muut tiedot tallennetaan XML-muodossa
taskmetadata sarakakkeeseen.

\subsection{Course}
Määrittelee kurssin nimen ja tunnisteen. Tähän tauluun viitataan useista muista tauluista,
jotta esimerkikisi opiskelijoiden suoritukset voidaan kirjata tietylle kurssille.

\subsection{Module}
EAssarin tehtäviä ei liitetä suoraan kursseihin, vaan moduuleihin ja moduulit liitetään
kursseihin. Kurssiin voi liittää useita moduuleja, mutta yhtä moduulia ei voi lisätä
useaan kurssiin. TitoTrainer ei käytä moduuleja siinä laajuudessa kuin tietokannan
rakenne mahdollistaisi, vaan toteutuksen ja käyttöliittymien yksinkertaistamiseksi
jokaiselle kurssille luodaan tarkalleen yksi moduuli johon lisätään kaikki tehtävät.

\subsection{Taskinmodule}
Yhdistää tehtävän kurssiin ja moduuliin. Normaalitapauksessa siis tehtävä lisättäisiin
jonkin kurssin johonkin moduulin luomalla rivi taskinmodule-tauluun. 

TitoTrainerin tapauksessa on määritelty, että kaikki tehtävät kuuluvat kaikkiin kursseihin,
joten kun opettaja luo tehtävän, TitoTrainer luo automaattisesti yhtä monta taskinmodule riviä
kuin on kursseja. Samoin kun luodaan uusi kurssi, sille luodaan automaattisesti moduuli ja
kaikki olemassa olevat tehtävät lisätään ko. moduuliin. Näin ollen Taskinmodule rivien määrä 
on aina Task rivien määrä * Course rivien määrä.

\subsection{Attributevalues}
Yleiskäyttöinen varasto jonne voi tallentaa mitä tahansa lisätietoa koskien mitä tahansa
muuta taulua. Tänne tallennetaan tehtävien kriteerit.

\subsection{EAuser}
Taulu kaikkien käyttäjätietojen tallentamiseen. Sekä oppilaat ja opettajat tallennetaan
tänne, erona näillä on vain status-sarakkeen arvo.

\subsection{Storedanswer}
Kun opiskelija vastaa tehtävään, vastaus sekä tiedot sen oikeellisuudesta tallennetaan
tähän tauluun.

\subsection{Studentmodel}
Jokaista tehtävän vastausyritystä kohden luodaan storedanswer-tauluun yksi rivi.
Studentmodel-taluun tallennetaan yksi rivi per tehtävä, vaikka vastausyrityksiä olisi
useampia. Rivillle tallennetaan tieto siitä, onko tehtävä suoritettu onnistuneesti
ja kuinka monta yritystä tehtävään on käytetty. Nämä tiedot olisi mahdollista päätellä SQL:n
koostefunktioden avulla storedanswer-taulusta, mutta ilmeisesti tehokkuuden parantamisksi
on luotu erillinen koostetaulu.

\subsection{Taskattributes}
Task-attributes on eAssarissa tarkoitettu kuvaamaan tehtävien attribuuttien rakennetta.
eAssari ei kuitenkaan missään vaiheessa itse hyödynnä tätä taulua, eikä TitoTrainerkään
sitä tarvitse, joten taulu jää täysin käyttämättä.

\subsection{Pluginparameters}
Tämän taulun tarkoitus on jäänyt täysin hämärän peittoon, eAssari ei missään kohtaa
koodissaan viittaa mihinkään plugineihin. TitoTrainerillä ei myöskään ole tälle 
taululle mitään käyttöä, joten se jää täysin käyttämättä.

\subsection{Pluginparamattributes}
Kuten pluginparameters, jää käyttämättä.



\newpage
\section{Monikielisyys}
Järjestelmän monikielisyys toteutetaan helposti ylläpidettävien xml-tiedostojen avulla.
Järjestelmää käynnistettäessä ladataan automaattisesti kaikki kieliriipuvaiset resurssit,
jolloin ne ovat jsp-sivujen käytettävissä yksinkertaisen rajapinnan kautta. Toteutuksessa
pyritään mahdollistamaan uusien kielivaihtoehtojen lisääminen vähällä vaivalla.

\subsection{xml-tiedostot}
Järjestelmä käyttää yksittäistä xml-tiedostoa yhden jsp-sivun sisältämän kieliriippuvaisen
datan tallentamiseen. Sivukohtaisen tiedoston rakenne on seuraava:

\begin{verbatim}
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment></comment>
	<entry key="kentänNimi_FI">kentän sisältö suomen kielellä</entry>
	<entry key="kentänNimi_EN">field content in english</entry>
</properties>
\end{verbatim}

Kielikohtainen data lisätään <entry> tagien avulla. Key arvoksi asetetaan resurssin nimi ja 
suffiksiksi kieli (\_FI, \_EN). JSP sivulla näkyvä sisältö kirjoitetaan tagien väliin.

Sivukohtaisten tiedostojen hallinnointi keskitetään xml-muotoiseen konfiguraatiotiedostoon.
Tässä tiedostossa määritellään järjestelmää käynnistettäessä ladattavat resurssit.
Konfiguraatiotiedoston rakenne on seuraava:

\begin{verbatim}
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment></comment>
	<entry key="jsp-sivu1">/tiedosto/polku/tdsto_nimi.xml</entry>
	<entry key="jsp-sivu2">/tiedosto/polku/tdsto_nimi.xml</entry>
</properties>
\end{verbatim}

\subsection{Monikielisyyden hallinnointi}
Kielipakettien hallinnointiin luodaan luokka LanguageManager. Luokka lukee järjestelmän
käynnistymisen yhteydessä ylläkuvatun xml-konfiguraatiotiedoston ja alustaa siinä määritellyt 
kielipaketit. Lisäksi luokka tarjoaa rajapinnan kielipakettien hakuun.

Yksittäisen kielipaketin toteuttaa luokka TitoBundle, joka periytyy java.util.ResourceBundle
luokasta. ResourceBundle luokkaa ei tosin käytetä täysin API:n mukaisesti, koska kielipakettien
lataaminen hoidetaan sen sijasta LanguageManager luokan avulla. TitoBundle luokka säilöö yksittäisen 
xml-tiedoston sisällön hajautustauluun java.util.Properties luokan avulla. 

\subsection{Monikielisyyden käyttö jsp-sivulta}
Kielivaihtoehtojen lisääminen jsp-sivuille hoituu seuraavasti. Sivua ladattaessa tarkistetaan 
sessiosta haluttu kieli ja pyydetään LanguageManager luokalta kielipakettia getTextResource metodilla.
Parametreina välitetään kieli ja jsp-sivun nimi. Metodin palauttaman kielipaketin metodilla
getString voidaan hakea tarvittava kieliriippuvainen data.

\begin{figure}[ht]
	\includegraphics[width=15cm] {sekvenssikaaviot/Kielen_haku_jspsivulta.eps}
	\caption{Kielipaketin käyttö jsp-sivulta}
\end{figure}



\newpage
\section{Luokat}
\input{classes}



\newpage
\section{JSP sivujen sekvenssikaaviot}
Tämä luku esittelee toteutettavien JSP-sivujen toimintalogiikan. Sekvenssikaaviot
esittelevät tärkeimmät eri toiminnoissa käytetyt luokat ja metodit, menemättä
kuitenkaan aivan samalle tasolle kuin lopullinen ohjelmakoodi. Myöskään kaikkia
toimintoja ei kuvata, esimerkiksi erilaisten listausten näyttäminen katsotaan niin
suoraviivaiseksi, että ne onnistuvat ilman erillistä suunnitelmaa. 

Sekvenssikaavioit esittävät miten TitoTrainer/eAssari käsittelee tapahtuman, jossa
käyttäjä on täyttänyt lomakkeen ja lähettänyt sen palvelimen käsiteltäväksi. Vain
onnistuneet tapahtumat on kuvattu, esimerkiksi väärän salasanan syöttäminen 
kirjautumislomakkeeseen katkaisee kuvatun sekvenssin ja palauttaa käyttäjälle
virheilmoituksen. 


\subsection{Signup.jsp}
\begin{figure}[ht]
	\includegraphics[width=15cm] {sekvenssikaaviot/Käyttäjän_luominen.eps}
	\caption{Käyttäjän rekisteröityminen}
\end{figure}
\newpage

\subsection{ModifyUser.jsp}
\begin{figure}[h!]
	\includegraphics[width=15cm] {sekvenssikaaviot/Käyttäjätietojen_muokkaaminen.eps}
	\caption{Käyttäjätietojen muokkaaminen}
\end{figure}
\newpage

\subsection{Login.jsp}
\begin{figure}[ht]
	\includegraphics[width=15cm] {sekvenssikaaviot/Login.eps}
	\caption{Kirjautuminen}
\end{figure}


\subsection{StudentTaskList.jsp}
Ei kaaviota. Sisältää vain opiskelijan tehtävälistauksen. 

\newpage

\subsection{TeacherTaskList.jsp}
\begin{figure}[ht]
	\includegraphics[width=15cm] {sekvenssikaaviot/Kurssinluonti.eps}
	\caption{Kurssin luominen ja tehtävien lisääminen luotuun kurssiin}
\end{figure}
\newpage


\subsection{CourseStatistics.jsp}
\begin{figure}[ht]
	\includegraphics[width=15cm] {muut_kaaviot/statistiikka_course_tasks.eps}
	\caption{Kurssin suoritustilastot opettajalle}
\end{figure}
\newpage


\subsection{UserInfo.jsp}
\begin{figure}[ht]
	\includegraphics[width=15cm] {muut_kaaviot/statistiikka_user_info.eps}
	\caption{statistiikka user info}
\end{figure}
\newpage
%\begin{figure}[ht]
%	\includegraphics[width=15cm] {muut_kaaviot/statistiikka_sivut.eps}
%	\caption{statistiikka sivut (rikkoo layoutin!}
%\end{figure}
%\newpage


\subsection{SearchUsers.jsp}
\begin{figure}[ht]
	\includegraphics[width=15cm] {muut_kaaviot/statistiikka_search_users.eps}
	\caption{Käyttäjähaku opettajalle}
\end{figure}
\newpage


\subsection{Composer.jsp}
\begin{figure}[ht]
	\includegraphics[width=15cm] {sekvenssikaaviot/Taskinluonti.eps}
	\caption{Tehtävän luominen ja lisääminen kursseille}
\end{figure}
\newpage

\begin{figure}[ht]
	\includegraphics[width=15cm] {sekvenssikaaviot/Taskin_muokkaaminen.eps}
	\caption{Tehtävän muokkaaminen}
\end{figure}
\newpage

\subsection{AnswerTask.jsp}
Näyttää tehtävävastauslomakkeen opiskelijalle.
\begin{figure}[ht]
	\includegraphics[width=15cm] {muut_kaaviot/answer_servletti.eps}
	\caption{Tehtävävastauksen toimintavuo}
\end{figure}
\newpage

\subsection{Answer-servlet}
Tarkastaa opiskelijan vastausyrityksen TitoAnalyzer luokan avulla ja tallentaa tuloksen
tietokantaan, sekä sessioon jotta AnswerTask.jsp voi näyttää palautetta opiskelijalle.
\begin{figure}[ht]
	\includegraphics[width=15cm] {sekvenssikaaviot/Tehtävän_tarkistus.eps}
	\caption{Kriteerin tarkistus ja palautteen määräytyminen}
\end{figure}
\newpage














