\section{Johdanto}

Kohahdus on järjestelmä automaattisesti tarkastettavien TTK-91-konekielen harjoitustehtävien 
luomiseen ja ratkaisemiseen. Järjestelmä on tarkoitettu käytettäväksi opetuksen tukena, 
opetettaessa Tietokoneen toiminta -kurssia. Tietojenkäsittelytieteen opettajat voivat tehdä 
järjestelmään uusia tehtäviä ja määritellä kuinka ne tarkastetaan automaattisesti. 
Tietokoneen toiminta -kurssin opiskelijat ja kurssin tehtävistä kiinnostuneet itseopiskelijat 
voivat ratkaista tehtäviä ja saada palautetta niiden onnistumisesta.

Painopiste projektissa on opettajan ja opiskelijan käyttöliittymillä. Käyttöliittymistä tehdään 
mahdollisimman selkeät ja helppokäyttöiset. Opettajan käyttöliittymän avulla määritellään tehtävät 
parametreineen ja kuinka opiskelijan ratkaisun oikeellisuus tarkistetaan, sekä nähdään statistiikkatietoja 
opiskelijoiden suorituksista. Opiskelijan käyttöliittymän avulla opiskelija valitsee tehtäviä, 
syöttää niiden ratkaisut ja saa palautetta vastauksensa oikeellisuudesta.

Projekti käyttää valmiina olevaa Titokone-simulaattoria harjoitustehtävien ratkaisemiseen. Projekti 
rakennetaan valmiina olevaan eAssari-kehykseen, joka sopii geneeriseen automaattisesti 
tarkistettavien tehtävien määrittelyyn ja toteutukseen.

Järjestelmä toteutetaan Java-kielellä ja järjestelmän käyttö vaatii, että selain tukee 
JavaScript-kieltä ja CSS-tyylitiedostoja. Järjestelmä toimii uusimmilla Firefox ja Internet 
Explorer-selaimilla.



\section{Sanasto}

\input{termit}



\section{Toiminnot}

Tämä lukuu kuvaa järjestelmän HTML-sivut ja sen, mitä toimintoja ne tarjoavät käyttäjälle.

\subsection{Rekisteröityminen}

Rekiströintisivulla opiskelija rekisteröityy järjestelmän käyttäjäksi. Rekisteröinti vaatii seuraavat 
tiedot: etunimi, sukunimi, sähköposti, opiskelijanumero tai henkilötunnus, sekä vapaavalintainen 
tunnus ja salasana

\subsection{Käyttäjätietojen muokkaaminen}

Käyttäjätietosivulla sisäänkirjautunut käyttäjä voi muokata rekisteröintitietojaan, poislukien 
tunnus joka on valittu rekisteröidyttäessä. 

\subsection{Kirjautuminen}

Kirjautumissivulla käyttäjä syöttää tunnuksensa, salasanansa ja pudotusvalikosta kurssin nimi.
Kurssivalinta määrittää, että minkä kurssin suorituksiin opiskelijan tekemät vastaukset tallennetaan.
Opettajan ollessa kyseessä kurssivalinnalla ei ole merkitystä. Jos kirjautuminen onnistuu, näytetään
tehtävälistaus. Jos kirjautuminen epäonnistuu, käyttäjä palautetaan kirjautumissivulle.

\subsection{Kurssien ja tehtävien valinta (opettaja)}

Kirjautumisen jälkeen opettajalle näytetään kurssilistaus josta opettaja voi siirtyä
kurssin statistiikka-sivulle. Kurssilistauksesen alla on myös lomake uuden kurssin
luomista varten.

Samalla sivulla näytetään myös tehtävälista. Listassa näytetään tehtävän kieli, aihepiiri
ja nimi, sekä viimeinen muokkauspäivä ja muokkaaja. Listattuja tehtäviä voi muokata ja
poistaa, sekä käynnistää uuden tehtävän luomisen.

\subsection{Tehtävän määrittely (opettaja)}

Tehtävänmäärittelysivulla opettaja voi luoda uuden tehtävän tai muokata olemassa olevaa
tehtävää. Tehtävälle määritellään nimi, tehtävänanto, tarkastustyyppi (malliratkaisu/kiinteät arvot),
tehtävätyyppi (täyttötehtävä/ohjelmointitehtävä), sekä tarkastuskriteerit ja kriteerien palautteet.

\subsection{Kurssin statistiikka (opettaja)}
Kurssin statistiikkasivulla opettajalle näytetään lista kaikkien kurssin tehtäviän suorittaneiden
opiskelijoiden suorituksista. Listassa näytetään opiskelijan nimi, opiskelijanumero tai henkilötunnus,
sekä onnistuneesti ratkaistujen tehtävien määrä. Lista on helposti tulostettavassa muodossa.

Listassa opiskelijan nimi toimii linkkinä ko. opiskelijan käyttäjätietosivulle.

\subsection{Käyttäjän tiedot (opettaja)}
Käyttäjän statistiikkasivulla opettajalle näytetään opiskelijan tarkemmat tiedot.
Listassa näkyy salasanaa lukuunottamatta kaikki rekisteröintitiedot.

\subsection{Tehtävien valinta (opiskelija)}

Kirjautumisen jälkeen opiskelijalle näytetään tehtävälista, josta opiskelija voi valita
tehtävän ratkaistavaksi. Listassa näytetään tehtävän kieli, aihepiiri ja nimi, sekä tieto
onko opiskelija yrittänyt jo tehtävän suoritusta ja onko yritys onnistunut.

\subsection{Tehtävään vastaaminen (opiskelija)}

Opiskelijan ratkaistavaksi valitsemasta tehtävästä näytetään nimi ja tehtävänanto,
mahdollinen valmis koodi mikäli kyseessä on täyttötehtävä, sekä tekstialue johon
opiskelija kirjoittaa vastauksensa. Lisäksi on linkki jolla pääsee takaisin tehtävälistaukseen.

Kun opiskelija on kirjoittanut vastauksensa, hän painaa "Suorita" nappia joka vie
takaisin tehtävävastaussivulle. Sivulla näytetään samat tiedot kuin alussa, mutta
lisäksi näytetään palautetta tehtävän ratkaisun onnistumisesta/epäonnistumisesta.



\section{Arkkitehtuurisuunnitelma}



\section{Tietokanta}

Tietotokannan rakenteen määrää eAssari kehys. Rakenne on kuvattu liitteessä 1. Ajanpuutteesta johtuen
module-tietokantataulua ei tulla käyttämään sen mahdollistamassa laajuudessa. Kyseisestä taulusta
luodaan vain yksi rivi kantaan, johon sitten viitataan muista tauluista. Lisäksi jokainen tehtävä
sisältyy jokaiseen kurssiin. Eli kun tehtävä luodaan, niin se liitetään jokaiseen kurssiin. Lisäksi 
kun kurssi luodaan, niin jokainen tehtävä lisätään kyseiseen uuteen kurssiin. Tämä linkitys tapahtuu
"taskinmodule"-tietokantataulussa. 

Tietokantaa käytetään aina DBHandler-luokan kautta, joka piilottaa tietokanta rakenteen yksityiskohdat.
Eli SQL-lauseita tulee vain ks. luokkaan eikä muualle koodiin. DBHandler-luokasta voidaan luoda instanssi
staattisen DBHandler.getInstance() -metodin avulla. Tämä tarkoittaa sitä, että ko. luokkaa voidaan 
käyttää virtuaalikoneen sisällä mistä vaan.

\section{Osajärjestelmät}



\section{Komponentit}



\section{Luokat}

DBConnectionPool
Analyzer
Displayer
Feedback
Composer
+jsp:t eri toiminnoille


public class DBHandler {
	Task[] getTasks(Course course)
	Task getTask(String taskId)
	void updateTask(Task task) // Update or insert
	void removeTask(Task task)
	
	User[] getUsers(Course course)
	User getUser(String userId)
	void updateUser(User user) // Update or insert
	void removeUser(User user)
}

public class Course {
	Course(courseID)
	
	// Implement if needed
	//void addTask(Task task)
	//void removeTask(Task task)
	//String getId()

	String getName()
	String setName(String name)
}



% Laajennetaan olemassa olevaa Task luokkaa
public class Task() {

	String getName();
	void setName(String name);
	
	String getAuthor();
	void setAuthor();

	Date getCreationDate();

	Criterion[] getCriteria(Task task);
	void setCriteria(Task task, Criterion[]);


	
	%%%%% Task-luokka %%%%%
	public DisplayerInterface getDisplayer(String language) 
	public AnalyserInterface getAnalyser(String language) 
	public boolean shouldAllowRetry(int triesSoFar) 
	public boolean shouldRegisterTry() 
	public boolean shouldStoreAnswer() 
	public boolean shouldBeAnalysed() 
	public boolean shouldKnowStudent()
	public String getTasktypeID () 
	public Tasktype getTasktype() 
	public String getTaskID() 
	public int getCutoffvalue() 
	public String getStyle() 
	public boolean wasSuccess(int points) 
	public boolean isInTime(Timestamp when) 
	
    String taskID;
    String courseID;
    String moduleID;
    String tasktypeID;
    Tasktype tasktype;
    int seqNo;
    Timestamp deadLine;
    boolean shouldStore;
    boolean shouldRegister;
    boolean shouldKnow;
    boolean shouldEvaluate;
    int cutoffvalue;
    int noOfTries;
    String style;
	
	%%%%% Task-taulu %%%%%
	taskid varchar(20) not null primary key,   /* each task has a unique id */
	taskname varchar(40),                      /* name of task in English - not used currently */
	tasktype varchar(40),                      /* the type of the task - this connects the displayer and analyser to the task */
	taskmetadata varchar(2000),                /* other task specific metadata - xml-format, not used currently  */
	numberoftries_def integer,                 /* how many tries are allowed - default value */
	shouldstoreanswer_def char,                /* should the system store the answer (Y/N) - default value */
	shouldregistertry_def char,                /* should the system register the try (Y/N) - default value */
	shouldknowstudent_def char,                /* must the student be known (Y/N) -default value */
	shouldevaluate_def char,                   /* should the task be evaluated on-line (Y/N) - default value */
	cutoffvalue integer,                       /* the value to be exceeded to pass the task */
	foreign key (tasktype) references tasktype


	%%%%% Taskinmodule-taulu %%%%%
	courseid            varchar(20) not null,  /* the course where used  */
	moduleid            varchar(20) not null,  /* the module where used */
	seqno               integer not null,      /* sequence number of the task within the module */
	taskid              varchar(20) not null,  /* which task is used */
	numberoftries       integer not null,      /* how many tries are allowed in this context */
	shouldstoreanswer   char,                  /* should the system store the answer (Y/N) in this context */
	shouldregistertry   char,                  /* should the system register the try (Y/N) in this context */
	shouldknowstudent   char,                  /* must the student be known (Y/N)in this context */
	shouldevaluate      char,                  /* should the task be evaluated immediately (Y/N) */
	cutoffvalue         integer,               /* the value to be exceeded to pass the task */
	primary key (courseid, moduleid, seqno),
	foreign key (taskid) references task,
	foreign key (courseid, moduleid) references module
   
  

}







% Nämä kesken
public abstract class Criterion {
	abstract boolean isValidAnswer(String answer)
	String getFailureFeedback()
	String getSuccessFeedback()
	boolean isQualityCriterion()
}
public abstract class SingleValueCriterion extends Criterion {
	boolean isValidAnswer(String answer)
	void setTestValue(int value);
	void setTestOperator(int optype);
}









public class User {
	User(userID)

	String getLastName();
	void setLastName(String name);

	String getFirstName();
	void setFirstName(String name);

	String getEmail();
	void setEmail(String addr);

	int getStatus() --   ST_ADMIN, ST_PRIVLEDGED, ST_TEACHER, ST_STUDENT

	String getStudentNumber() -- extid
	void setStudentNumber(String) -- extid

	String getSocialSecurityNumber() -- extid2
	void setSocialSecurityNumber(String) -- extid2

	String getPassword()
	void setPassword(String)

	String getLanguage()
	void setLanguage(String) -- 'EN' 'FI'
	
	boolean isTeacher()
}






